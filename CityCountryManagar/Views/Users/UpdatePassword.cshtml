@model RidersApp.ViewModels.UpdatePasswordVM
@{
    Layout = null;
}

<form asp-action="UpdatePassword" asp-controller="Users" method="post" onsubmit="return ajaxFormSubmit(this);" autocomplete="off">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="Id" />
    
    <div class="alert alert-info" role="alert">
        <i class="fas fa-info-circle"></i> 
        <strong>Update Password for:</strong> @Model.FullName (@Model.Email)
    </div>
    
    <div class="form-group">
        <label asp-for="NewPassword"></label>
        <input asp-for="NewPassword" class="form-control" type="password" 
               autocomplete="new-password" 
               placeholder="Enter new password (minimum 8 characters)" />
        <span asp-validation-for="NewPassword" class="text-danger"></span>
        <small class="form-text text-muted">
            <strong>Password Requirements:</strong> Minimum 8 characters.
        </small>
    </div>

    <div class="form-group">
        <label asp-for="ConfirmPassword"></label>
        <input asp-for="ConfirmPassword" class="form-control" type="password" 
               autocomplete="new-password" 
               placeholder="Confirm the new password" />
        <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
        <small class="form-text text-muted">
            Re-enter the new password to confirm it matches.
        </small>
    </div>

    <div class="form-group mt-3 text-end">
        <button type="submit" class="btn btn-warning">
            <i class="fas fa-key"></i> Update Password
        </button>
        <button type="button" class="btn btn-secondary" onclick="$('#form-modal').modal('hide');">
            <i class="fas fa-times"></i> Cancel
        </button>
    </div>
</form>

<script>
    $(document).ready(function() {
        var newPasswordField = $('input[name="NewPassword"]');
        var confirmPasswordField = $('input[name="ConfirmPassword"]');
        
        console.log('Update Password form loaded');
        
        // Real-time password confirmation validation
        function validatePasswordMatch() {
            var newPassword = newPasswordField.val();
            var confirmPassword = confirmPasswordField.val();
            
            if (confirmPassword.length > 0) {
                if (newPassword === confirmPassword) {
                    confirmPasswordField.removeClass('is-invalid').addClass('is-valid');
                    confirmPasswordField.next('.text-danger').text('');
                } else {
                    confirmPasswordField.removeClass('is-valid').addClass('is-invalid');
                    confirmPasswordField.next('.text-danger').text('Passwords do not match.');
                }
            } else {
                confirmPasswordField.removeClass('is-valid is-invalid');
                confirmPasswordField.next('.text-danger').text('');
            }
        }
        
        newPasswordField.on('input', validatePasswordMatch);
        confirmPasswordField.on('input', validatePasswordMatch);
    });
</script>